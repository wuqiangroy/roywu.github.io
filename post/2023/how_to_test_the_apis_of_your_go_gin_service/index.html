<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How to test the APIs of your Go-Gin service? | Roy&#39;s Records</title>
<meta name="keywords" content="golang, gin, test">
<meta name="description" content="As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it. When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It&rsquo;s seems ridiculous and non-product. We need to have a full-check for the APIs and it&rsquo;s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes.">
<meta name="author" content="wuqiangroy">
<link rel="canonical" href="http://wuqiangroy.github.io/post/2023/how_to_test_the_apis_of_your_go_gin_service/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://wuqiangroy.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://wuqiangroy.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wuqiangroy.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://wuqiangroy.github.io/apple_touch_icon.png">
<link rel="mask-icon" href="https://wuqiangroy.github.io/safari_pinned_tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="How to test the APIs of your Go-Gin service?" />
<meta property="og:description" content="As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it. When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It&rsquo;s seems ridiculous and non-product. We need to have a full-check for the APIs and it&rsquo;s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://wuqiangroy.github.io/post/2023/how_to_test_the_apis_of_your_go_gin_service/" /><meta property="og:image" content="http://wuqiangroy.github.io/papermod-cover.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-01-03T11:17:20+08:00" />
<meta property="article:modified_time" content="2023-01-03T11:17:20+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://wuqiangroy.github.io/papermod-cover.png"/>

<meta name="twitter:title" content="How to test the APIs of your Go-Gin service?"/>
<meta name="twitter:description" content="As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it. When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It&rsquo;s seems ridiculous and non-product. We need to have a full-check for the APIs and it&rsquo;s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://wuqiangroy.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How to test the APIs of your Go-Gin service?",
      "item": "http://wuqiangroy.github.io/post/2023/how_to_test_the_apis_of_your_go_gin_service/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to test the APIs of your Go-Gin service?",
  "name": "How to test the APIs of your Go-Gin service?",
  "description": "As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it. When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It\u0026rsquo;s seems ridiculous and non-product. We need to have a full-check for the APIs and it\u0026rsquo;s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes.",
  "keywords": [
    "golang", "gin", "test"
  ],
  "articleBody": "As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it. When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It’s seems ridiculous and non-product. We need to have a full-check for the APIs and it’s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes.\nwrite a Go-Gin service It’s very easy to write a web server using Go-Gin, here’s an example of exporting the information of an user. The very first step, we need to create a workplace named webserver. The architechture is:\n1 2 3 4 5 6 webserver -- module -- user.go -- main.go -- go.sum -- go.mod The logic codes are under a module file: module/user.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 package module import ( \"net/http\" \"github.com/gin-gonic/gin\" ) type UserInfo struct { Nickname string `json: \"nickname\"` UserID string `json:\"userID\"` // unique for all users Gender int `json:\"gender\"` // 0 - male 1 - female BirthDay string `json:\"birthday\"` } func GetUser(c *gin.Context) { name := c.Request.FormValue(\"name\") if name == \"Joe\" { var user = UserInfo{ Nickname: \"Joe\", UserID: \"113113\", Gender: 0, BirthDay: \"1990-01-01\", } c.IndentedJSON(http.StatusOK, user) return } c.IndentedJSON(http.StatusBadRequest, nil) return } main.go is our start process, here we register all the routers. main.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 package main import ( \"webserver/module\" \"github.com/gin-gonic/gin\" ) func main() { r := gin.Default() r.GET(\"/user\", module.GetUser) r.Run() } We set a form value of name here, if only the name equals Joe, the info of Joe will be sent out, but other name will get the HTTP status 400. Then run go run main.go to start the webserver.\ntest the APIs using postman Postman is a well-known GUI API test tool, easy and elegant to use, ofcourse, here you can use other GUI tools you like, suck as RapidApi and Apifox.\nWhen I set the name Joe, I’ll get the info of Joe: But others will only get BadRequest: You can use your own tool to test it.\nwrite an unit-test for the APIs We’ve already test out API by using postman, it seems OK now. But it’s only a very good tool for programmer, although it clear and easy to use, help us fix bug and check the API realtime. Somtimes, we change a universal function, it’s may effect to all the apis, although we sure the function is 100 percent OK and have beed tested full, but we still need to query all the APIs manually in the GUI software Postman. When you have 1000 APIs, you may crazy. Actually, Postman provides us a test tool and mock data now, you can test all your APIs by one click, but if a lazy boy changed the universal function, just testing it but forget to run the test? This may case a bad issue. We still need to write test code for it, we need to write the test code and integrate in Git pipeline, only the pipeline passed, your code will be commit successfully. Now, Gin provides a good function to call APIs directly. Create a new file: test/api_test.go Now, your architechture may like this:\n1 2 3 4 5 6 7 8 webserver -- module -- user.go -- test -- api_test.go main.go go.sum go.mod module/user.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 package main import ( \"encoding/json\" \"fmt\" \"net/http\" \"net/http/httptest\" \"testing\" \"webserver/module\" \"github.com/gin-gonic/gin\" \"github.com/stretchr/testify/assert\" ) func TestGetUser(t *testing.T) { var url = \"/user\" r := gin.Default() r.GET(url, module.GetUser) w := httptest.NewRecorder() req, _ := http.NewRequest(http.MethodGet, \"/user\", nil) r.ServeHTTP(w, req) assert.Equal(t, http.StatusBadRequest, w.Code) var name = \"Joe\" req2, _ := http.NewRequest(http.MethodGet, \"/user?name=\"+name, nil) w = httptest.NewRecorder() r.ServeHTTP(w, req2) var data map[string]string fmt.Println(w.Code) json.Unmarshal(w.Body.Bytes(), \u0026data) fmt.Println(data) assert.Equal(t, http.StatusOK, w.Code) assert.Equal(t, data[\"Nickname\"], name) } We have 2 data checker here, one is checking the BadRequest and another is checking normal request. We can use go test -v test/* test all the test files under the test file. Result:\n$ go test -v test/* === RUN TestGetUser [GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached. [GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production. - using env: export GIN_MODE=release - using code: gin.SetMode(gin.ReleaseMode) [GIN-debug] GET /user --\u003e webserver/module.GetUser (3 handlers) [GIN] 2023/01/03 - 16:54:25 | 400 | 203.5µs | | GET \"/user\" [GIN] 2023/01/03 - 16:54:25 | 200 | 31.084µs | | GET \"/user?name=Joe\" 200 map[Nickname:Joe birthday:1990-01-01 gender: userID:113113] --- PASS: TestGetUser (0.00s) PASS ok command-line-arguments 0.584s Let me modify the name Joe to Jo, this time, the test should be failed.\n$ go test -v test/* === RUN TestGetUser [GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached. [GIN-debug] [WARNING] Running in \"debug\" mode. Switch to \"release\" mode in production. - using env: export GIN_MODE=release - using code: gin.SetMode(gin.ReleaseMode) [GIN-debug] GET /user --\u003e webserver/module.GetUser (3 handlers) [GIN] 2023/01/03 - 16:57:23 | 400 | 139.666µs | | GET \"/user\" [GIN] 2023/01/03 - 16:57:23 | 400 | 2.459µs | | GET \"/user?name=Jo\" 400 map[] api_test.go:33: Error Trace: /webserver/test/api_test.go:33 Error: Not equal: expected: 200 actual : 400 Test: TestGetUser api_test.go:34: Error Trace: /webserver/test/api_test.go:34 Error: Not equal: expected: \"\" actual : \"Jo\" Diff: --- Expected +++ Actual @@ -1 +1 @@ - +Jo Test: TestGetUser --- FAIL: TestGetUser (0.00s) FAIL FAIL command-line-arguments 0.469s FAIL That means when we modified the universal code, the pipeline of test may fail and our codes need to be check.\nCI-CD Above, our test command is go test -v test/*. So, when we need CI-CD, we only need to add this command to your .gitlab-ci.yaml file, maybe you can add a new stage named test. If you are the first time hearing .gitlab-ci.yaml, here’s a reference for you: The .gitlab-ci.yml file ",
  "wordCount" : "1042",
  "inLanguage": "en",
  "datePublished": "2023-01-03T11:17:20+08:00",
  "dateModified": "2023-01-03T11:17:20+08:00",
  "author":{
    "@type": "Person",
    "name": "wuqiangroy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://wuqiangroy.github.io/post/2023/how_to_test_the_apis_of_your_go_gin_service/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Roy's Records",
    "logo": {
      "@type": "ImageObject",
      "url": "https://wuqiangroy.github.io/favicon-32x32.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://wuqiangroy.github.io/" accesskey="h" title="Roy&#39;s Records (Alt + H)">Roy&#39;s Records</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://wuqiangroy.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://wuqiangroy.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://wuqiangroy.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://wuqiangroy.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://wuqiangroy.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://wuqiangroy.github.io/">Home</a>&nbsp;»&nbsp;<a href="http://wuqiangroy.github.io/post/">Posts</a></div>
    <h1 class="post-title">
      How to test the APIs of your Go-Gin service?
    </h1>
    <div class="post-meta"><span title='2023-01-03 11:17:20 +0800 CST'>January 3, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;wuqiangroy

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#write-a-go-gin-service" aria-label="write a Go-Gin service">write a Go-Gin service</a></li>
                <li>
                    <a href="#test-the-apis-using-postman" aria-label="test the APIs using postman">test the APIs using postman</a></li>
                <li>
                    <a href="#write-an-unit-test-for-the-apis" aria-label="write an unit-test for the APIs">write an unit-test for the APIs</a></li>
                <li>
                    <a href="#ci-cd" aria-label="CI-CD">CI-CD</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>As the pre-post said, Gin is a famouse web framework writen by Go. I love it and always use it.</br>
When I wrote a web server using Go-Gin, how do I test the APIs? This may confused me, only use a command-line tool to verify them? It&rsquo;s seems ridiculous and non-product. </br>
We need to have a full-check for the APIs and it&rsquo;s better to make it automatic, then we need to integrate it in the CI-CD pipline, make sure that it will run automaticly after we commit codes.</br></p>
<h2 id="write-a-go-gin-service">write a Go-Gin service<a hidden class="anchor" aria-hidden="true" href="#write-a-go-gin-service">#</a></h2>
<p>It&rsquo;s very easy to write a web server using Go-Gin, here&rsquo;s an example of exporting the information of an user.</br>
The very first step, we need to create a workplace named <code>webserver</code>.</br>
The architechture is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">webserver</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">module</span>
</span></span><span class="line"><span class="cl">		<span class="err">--</span> <span class="err">user.go</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">main.go</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">go.sum</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">go.mod</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The logic codes are under a <code>module</code> file:</br>
<code>module/user.go</code></br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">module</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">UserInfo</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Nickname</span> <span class="kt">string</span> <span class="s">`json: &#34;nickname&#34;`</span>
</span></span><span class="line"><span class="cl">	<span class="nx">UserID</span>   <span class="kt">string</span> <span class="s">`json:&#34;userID&#34;`</span> <span class="c1">// unique for all users
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Gender</span>   <span class="kt">int</span>    <span class="s">`json:&#34;gender&#34;`</span> <span class="c1">// 0 - male 1 - female
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">BirthDay</span> <span class="kt">string</span> <span class="s">`json:&#34;birthday&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">GetUser</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">name</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Request</span><span class="p">.</span><span class="nf">FormValue</span><span class="p">(</span><span class="s">&#34;name&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">name</span> <span class="o">==</span> <span class="s">&#34;Joe&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">var</span> <span class="nx">user</span> <span class="p">=</span> <span class="nx">UserInfo</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Nickname</span><span class="p">:</span> <span class="s">&#34;Joe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">UserID</span><span class="p">:</span>   <span class="s">&#34;113113&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">Gender</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">BirthDay</span><span class="p">:</span> <span class="s">&#34;1990-01-01&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="nx">c</span><span class="p">.</span><span class="nf">IndentedJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">c</span><span class="p">.</span><span class="nf">IndentedJSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>main.go</code> is our start process, here we register all the routers.</br>
<code>main.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;webserver/module&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">GetUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We set a form value of name here, if only the name equals <code>Joe</code>, the info of <code>Joe</code> will be sent out, but other name will get the HTTP status 400.</br>
Then run <code>go run main.go</code> to start the webserver.</br></p>
<h2 id="test-the-apis-using-postman">test the APIs using postman<a hidden class="anchor" aria-hidden="true" href="#test-the-apis-using-postman">#</a></h2>
<p><a href="https://www.postman.com/">Postman</a> is a well-known GUI API test tool, easy and elegant to use, ofcourse, here you can use other GUI tools you like, suck as <a href="https://paw.cloud/">RapidApi</a> and <a href="https://www.apifox.cn/">Apifox</a>.</br></p>
<p>When I set the name <code>Joe</code>, I&rsquo;ll get the info of <code>Joe</code>:</br>
<a href="https://imgse.com/i/pSiMVWq"><img loading="lazy" src="https://s1.ax1x.com/2023/01/03/pSiMVWq.png" alt="pSiMVWq.png"  />
</a>
But others will only get BadRequest:</br>
<a href="https://imgse.com/i/pSiMlTJ"><img loading="lazy" src="https://s1.ax1x.com/2023/01/03/pSiMlTJ.png" alt="pSiMlTJ.png"  />
</a></p>
<p>You can use your own tool to test it.</br></p>
<h2 id="write-an-unit-test-for-the-apis">write an unit-test for the APIs<a hidden class="anchor" aria-hidden="true" href="#write-an-unit-test-for-the-apis">#</a></h2>
<p>We&rsquo;ve already test out API by using postman, it seems OK now. But it&rsquo;s only a very good tool for programmer, although it clear and easy to use, help us fix bug and check the API realtime.</br>
Somtimes, we change a universal function, it&rsquo;s may effect to all the apis, although we sure the function is 100 percent OK and have beed tested full, but we still need to query all the APIs manually in the GUI software Postman. When you have 1000 APIs, you may crazy.</br>
Actually, Postman provides us a test tool and mock data now, you can test all your APIs by one click, but if a lazy boy changed the universal function, just testing it but forget to run the test? This may case a bad issue. </br>
We still need to write test code for it, we need to write the test code and integrate in Git pipeline, only the pipeline passed, your code will be commit successfully.</br>
Now, Gin provides a good function to call APIs directly.</br>
Create a new file: <code>test/api_test.go</code></br>
Now, your architechture may like this:</br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">webserver</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">module</span>
</span></span><span class="line"><span class="cl">		<span class="err">--</span> <span class="err">user.go</span>
</span></span><span class="line"><span class="cl">	<span class="err">--</span> <span class="err">test</span>
</span></span><span class="line"><span class="cl">		<span class="err">--</span> <span class="err">api_test.go</span>
</span></span><span class="line"><span class="cl">	<span class="err">main.go</span>
</span></span><span class="line"><span class="cl">	<span class="err">go.sum</span>
</span></span><span class="line"><span class="cl">	<span class="err">go.mod</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>module/user.go</code></br></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/json&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;net/http/httptest&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;testing&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;webserver/module&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/stretchr/testify/assert&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">TestGetUser</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">url</span> <span class="p">=</span> <span class="s">&#34;/user&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nf">Default</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">GET</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">GetUser</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nx">w</span> <span class="o">:=</span> <span class="nx">httptest</span><span class="p">.</span><span class="nf">NewRecorder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">req</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="s">&#34;/user&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span><span class="p">,</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">name</span> <span class="p">=</span> <span class="s">&#34;Joe&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="nx">req2</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodGet</span><span class="p">,</span> <span class="s">&#34;/user?name=&#34;</span><span class="o">+</span><span class="nx">name</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">w</span> <span class="p">=</span> <span class="nx">httptest</span><span class="p">.</span><span class="nf">NewRecorder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">req2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">var</span> <span class="nx">data</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">Code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nf">Bytes</span><span class="p">(),</span> <span class="o">&amp;</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">w</span><span class="p">.</span><span class="nx">Code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">assert</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">data</span><span class="p">[</span><span class="s">&#34;Nickname&#34;</span><span class="p">],</span> <span class="nx">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We have 2 data checker here, one is checking the BadRequest and another is checking normal request.</br>
We can use <code>go test -v test/*</code> test all the test files under the test file.</br>
Result:</br></p>
<pre tabindex="0"><code>$ go test -v test/*
=== RUN   TestGetUser
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in &#34;debug&#34; mode. Switch to &#34;release&#34; mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /user                     --&gt; webserver/module.GetUser (3 handlers)
[GIN] 2023/01/03 - 16:54:25 | 400 |       203.5µs |                 | GET      &#34;/user&#34;
[GIN] 2023/01/03 - 16:54:25 | 200 |      31.084µs |                 | GET      &#34;/user?name=Joe&#34;
200
map[Nickname:Joe birthday:1990-01-01 gender: userID:113113]
--- PASS: TestGetUser (0.00s)
PASS
ok      command-line-arguments  0.584s
</code></pre><p>Let me modify the name <code>Joe</code> to <code>Jo</code>, this time, the test should be failed.</p>
<pre tabindex="0"><code>$ go test -v test/*
=== RUN   TestGetUser
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in &#34;debug&#34; mode. Switch to &#34;release&#34; mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /user                     --&gt; webserver/module.GetUser (3 handlers)
[GIN] 2023/01/03 - 16:57:23 | 400 |     139.666µs |                 | GET      &#34;/user&#34;
[GIN] 2023/01/03 - 16:57:23 | 400 |       2.459µs |                 | GET      &#34;/user?name=Jo&#34;
400
map[]
    api_test.go:33: 
                Error Trace:    /webserver/test/api_test.go:33
                Error:          Not equal: 
                                expected: 200
                                actual  : 400
                Test:           TestGetUser
    api_test.go:34: 
                Error Trace:    /webserver/test/api_test.go:34
                Error:          Not equal: 
                                expected: &#34;&#34;
                                actual  : &#34;Jo&#34;
                            
                                Diff:
                                --- Expected
                                +++ Actual
                                @@ -1 +1 @@
                                -
                                +Jo
                Test:           TestGetUser
--- FAIL: TestGetUser (0.00s)
FAIL
FAIL    command-line-arguments  0.469s
FAIL
</code></pre><p>That means when we modified the universal code, the pipeline of test may fail and our codes need to be check.</br></p>
<h2 id="ci-cd">CI-CD<a hidden class="anchor" aria-hidden="true" href="#ci-cd">#</a></h2>
<p>Above, our test command is <code>go test -v test/*</code>.</br>
So, when we need CI-CD, we only need to add this command to your <code>.gitlab-ci.yaml</code> file, maybe you can add a new stage named <code>test</code>.</br>
If you are the first time hearing <code>.gitlab-ci.yaml</code>, here&rsquo;s a reference for you:
<a href="https://docs.gitlab.com/ee/ci/yaml/gitlab_ci_yaml.html">The .gitlab-ci.yml file </a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://wuqiangroy.github.io/tags/golang/">golang</a></li>
      <li><a href="http://wuqiangroy.github.io/tags/gin/">gin</a></li>
      <li><a href="http://wuqiangroy.github.io/tags/test/">test</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://wuqiangroy.github.io/post/2023/how_to_enable_remote_access_for_docker/">
    <span class="title">« Prev</span>
    <br>
    <span>How to enable remote access for Docker</span>
  </a>
  <a class="next" href="http://wuqiangroy.github.io/post/2023/how_to_set_a_go_project_as_a_module/">
    <span class="title">Next »</span>
    <br>
    <span>How to set a Go project as a Go module?</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="http://wuqiangroy.github.io/">Roy&#39;s Records</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
